#!/usr/bin/env python3
# -*- coding: utf-8 -*-

__author__ = 'Victor H채ggqvist, Yuriy Netesov'
__copyright__ = 'Copyright 2014-2015, Victor H채ggqvist'
__credits__ = ['Victor H채ggqvist', 'Yuriy Netesov']
__license__ = 'GPL-2.0'
__maintainer__ = 'Victor H채ggqvist <victor@hggqvst.com>'

import sys
import argparse
import subprocess
from xboomx.config import config
from xboomx.sqlitemgr import get_session, PathItem


def print_stats():
    """
    Display statistics about the application launches
    """
    session = get_session()
    items = session.query(PathItem).order_by(PathItem.count.desc())

    print('Application\tLaunches')
    for item in items:
        if len(item.name) < 8:
            print(f'{item.name}\t\t{item.count}')
        else:
            print(f'{item.name}\t{item.count}')


def main():
    parser = argparse.ArgumentParser(description='Run dmenu with entries sorted by usage frequency.')
    parser.add_argument('--stats', action='store_true', help='Display application launch statistics.')

    args = parser.parse_args()

    if args.stats:
        print_stats()
        exit(0)

    dmenu_launcher = f'dmenu {config.get("dmenu_params", "")}'
    subprocess.call(f'xboomx_sort.py | {dmenu_launcher} | xboomx_update.py | xargs -I {{}} sh -c \'exec {{}} &\'', shell=True)

if __name__ == '__main__':
    main()
